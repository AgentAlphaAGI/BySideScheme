# åœ¨æ—æœ¯ (BySideScheme) API æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†åç«¯æœåŠ¡æä¾›çš„æ‰€æœ‰ API æ¥å£ã€è¯·æ±‚å‚æ•°åŠå“åº”ç¤ºä¾‹ã€‚

## åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8001`
- **Content-Type**: `application/json`

## é‰´æƒï¼ˆå¯é€‰ï¼‰

æœ¬æœåŠ¡æ”¯æŒå¯é€‰çš„ API Key é‰´æƒï¼š
- è‹¥æœåŠ¡ç«¯æœªè®¾ç½® `BySideScheme_API_KEY`ï¼ˆæˆ–ä¸ºç©ºï¼‰ï¼Œæ¥å£é»˜è®¤ä¸æ ¡éªŒé‰´æƒ
- è‹¥æœåŠ¡ç«¯è®¾ç½®äº† `BySideScheme_API_KEY`ï¼Œåˆ™æ‰€æœ‰ HTTP è¯·æ±‚éœ€è¦æºå¸¦è¯·æ±‚å¤´ `X-API-Key: <BySideScheme_API_KEY>`ï¼Œå¦åˆ™è¿”å› 401

WebSocket ä¹ŸåŒæ ·ï¼šæ¡æ‰‹é˜¶æ®µéœ€æºå¸¦ `X-API-Key`ï¼ˆå½“æœåŠ¡ç«¯å¼€å¯æ ¡éªŒæ—¶ï¼‰ã€‚

## é€šç”¨é”™è¯¯æ ¼å¼

FastAPI é»˜è®¤é”™è¯¯æ ¼å¼ç¤ºä¾‹ï¼š

```json
{ "detail": "..." }
```

---

## ğŸ­ èŒåœºæ¨¡æ‹Ÿå™¨ (Simulator)

åŸºäº AutoGen å¤šæ™ºèƒ½ä½“æ¡†æ¶ï¼Œæ¨¡æ‹ŸçœŸå®çš„èŒåœºäººé™…äº¤äº’ç¯å¢ƒã€‚

è¡¥å……èƒ½åŠ›ï¼š
1. å¯åœ¨ `people[].engine` ä¸ºä¸åŒäººç‰©æŒ‡å®šä¸åŒæ¨¡å‹ï¼ˆå¦‚ deepseek/qwen3/glmï¼‰ï¼Œæå‡å¹¶å‘ååä¸è§’è‰²å·®å¼‚æ€§
2. è‹¥ä¼ å…¥ `user_id`ï¼Œç³»ç»Ÿä¼šåœ¨æ¨æ¼”ä¸­æŒä¹…åŒ–â€œç”»åƒæ ¡å‡†â€ï¼Œå¹¶åœ¨åç»­ä¼šè¯å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½æœ€æ–°ç”»åƒ
3. è‹¥ä¼ å…¥ `situation` æˆ–å·²é€šè¿‡ `/situation/update` ä¿å­˜å±€åŠ¿ï¼ˆå¹¶åœ¨è¯·æ±‚ä¸­ä¼  `user_id`ï¼‰ï¼Œ`analysis` ä¼šæŠŠå±€åŠ¿çº³å…¥é£é™©ä¸ç­–ç•¥åˆ¤æ–­

### æ•°æ®ç»“æ„è¯´æ˜

**äººç‰©åŠ¨æ€åŠ è½½ï¼ˆpeopleï¼‰**
- `people[]` æ˜¯æ¨èæ–¹å¼ï¼ˆå¯åŒæ—¶åŒ…å« leader/colleagueï¼‰ï¼Œå­—æ®µï¼š
  - `kind`: `"leader"` | `"colleague"`
  - `name`: äººç‰©åç§°ï¼ˆç”¨äºå¯¹è¯å‘è¨€è€…æ ‡è¯†ã€ç”»åƒç‰ˆæœ¬å­˜å– keyï¼‰
  - `title`: å¤´è¡”ï¼ˆleader å»ºè®®å¡«å†™ï¼›colleague å¯ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
  - `persona`: åˆå§‹ç”»åƒæ–‡æœ¬
  - `engine`: è§’è‰²ä½¿ç”¨çš„æ¨¡å‹å¼•æ“åï¼ˆå¦‚ `"deepseek"` / `"qwen3"` / `"glm"`ï¼‰ï¼Œç”¨äºä»ç¯å¢ƒå˜é‡è¯»å–å¯¹åº” `{ENGINE}_API_KEY/{ENGINE}_BASE_URL/{ENGINE}_MODEL`ã€‚å¦‚æœä¸å¡«ï¼Œé»˜è®¤ä½¿ç”¨ç³»ç»Ÿé…ç½®çš„é€šç”¨æ¨¡å‹ã€‚

**å±€åŠ¿ï¼ˆsituationï¼‰**
- å¯é€‰ï¼Œç»“æ„ä¸ `/situation/update` çš„ `situation` ä¸€è‡´ï¼›è‹¥ä¸ä¼ ä¸”ä¼ äº† `user_id`ï¼ŒæœåŠ¡ç«¯ä¼šä»æ•°æ®åº“åŠ è½½å·²ä¿å­˜çš„å±€åŠ¿ã€‚

### 10. åˆå§‹åŒ–æ¨¡æ‹Ÿä¼šè¯
**POST** `/simulator/start`

åˆ›å»ºä¸€ä¸ªæ–°çš„èŒåœºæ¨¡æ‹Ÿç¯å¢ƒï¼ŒåŒ…å«ç”¨æˆ·è‡ªå·±ã€é¢„è®¾çš„é¢†å¯¼ Agentã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user_001",
  "user_name": "Me",
  "people": [
    {
      "kind": "leader",
      "name": "David",
      "title": "ç›´å±é¢†å¯¼",
      "persona": "æ§åˆ¶æ¬²å¼ºï¼Œå–œæ¬¢å¬å¥½è¯ï¼Œä½†å…³é”®æ—¶åˆ»èƒ½æ‰›äº‹ã€‚å£å¤´ç¦…æ˜¯'æŠ“æ‰‹'ã€'èµ‹èƒ½'ã€‚",
      "engine": "deepseek"
    },
    {
      "kind": "leader",
      "name": "Sarah",
      "title": "éƒ¨é—¨æ€»ç›‘",
      "persona": "ç»“æœå¯¼å‘ï¼Œé›·å‰é£è¡Œï¼Œä¸å–œæ¬¢å¬å€Ÿå£ï¼Œåªçœ‹æ•°æ®ã€‚",
      "engine": "qwen3"
    },
    {
      "kind": "colleague",
      "name": "Alex",
      "title": "",
      "persona": "è°¨æ…åŠ¡å®ï¼Œæ“…é•¿è¡¥å……ç»†èŠ‚ï¼Œå–œæ¬¢æŠŠäº‹æƒ…æ‹†æˆå¯æ‰§è¡Œæ¸…å•ã€‚",
      "engine": "glm"
    }
  ],
  "leaders": [
    {
      "name": "David",
      "title": "ç›´å±é¢†å¯¼",
      "persona": "æ§åˆ¶æ¬²å¼ºï¼Œå–œæ¬¢å¬å¥½è¯ï¼Œä½†å…³é”®æ—¶åˆ»èƒ½æ‰›äº‹ã€‚å£å¤´ç¦…æ˜¯'æŠ“æ‰‹'ã€'èµ‹èƒ½'ã€‚"
    },
    {
      "name": "Sarah",
      "title": "éƒ¨é—¨æ€»ç›‘",
      "persona": "ç»“æœå¯¼å‘ï¼Œé›·å‰é£è¡Œï¼Œä¸å–œæ¬¢å¬å€Ÿå£ï¼Œåªçœ‹æ•°æ®ã€‚"
    }
  ]
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

### 11. å‘é€æ¶ˆæ¯å¹¶è·å–å›å¤
**POST** `/simulator/chat`

ç”¨æˆ·åœ¨æ¨¡æ‹Ÿå™¨ä¸­å‘è¨€ï¼Œè§¦å‘å¤š Agent äº¤äº’ï¼Œå¹¶è·å–ä»–ä»¬çš„å›å¤æµã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "å¤§å®¶è§‰å¾—è¿™ä¸ªæ–¹æ¡ˆæ€ä¹ˆæ ·ï¼Ÿ"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "new_messages": [
    {
      "sender": "David",
      "content": "æˆ‘è§‰å¾—æ–¹å‘æ˜¯å¯¹çš„ï¼Œä½†æ˜¯æŠ“æ‰‹åœ¨å“ªé‡Œï¼Ÿ",
      "role": "assistant"
    },
    {
      "sender": "Sarah",
      "content": "æ•°æ®å‘¢ï¼Ÿæˆ‘éœ€è¦çœ‹åˆ°ROIçš„é¢„æµ‹ã€‚",
      "role": "assistant"
    }
  ],
  "analysis": {
    "situation_insights": [
      "ä¸¤ä½é¢†å¯¼å…³æ³¨ç‚¹ä¸åŒï¼šDavid å…³æ³¨æŠ“æ‰‹/æ‰§è¡Œï¼ŒSarah å…³æ³¨æ•°æ®/ROIã€‚"
    ],
    "overall_risk_score": 55,
    "risks": [
      {
        "title": "æŒ‡æ ‡ä¸æ–¹æ¡ˆæœªå¯¹é½",
        "severity": "medium",
        "trigger": "ç»§ç»­è®¨è®ºæ–¹æ¡ˆç»†èŠ‚ä½†ä¸ç»™å‡ºé‡åŒ– ROI æˆ–é‡Œç¨‹ç¢‘",
        "impact": "å†³ç­–è¢«æ‹–å»¶ï¼Œæˆ–è¢«è®¤ä¸ºå‡†å¤‡ä¸è¶³",
        "evidence": ["Sarah: æ•°æ®å‘¢ï¼Ÿæˆ‘éœ€è¦çœ‹åˆ°ROIçš„é¢„æµ‹ã€‚"],
        "mitigation": ["è¡¥ä¸€é¡µROIå‡è®¾ä¸æ•æ„Ÿæ€§åˆ†æ", "ç»™å‡ºé‡Œç¨‹ç¢‘ä¸æŠ“æ‰‹æ¸…å•"]
      }
    ],
    "persona_updates": [],
    "next_actions": ["å…ˆç¡®è®¤ ROI å£å¾„ä¸æ—¶é—´è¡¨ï¼Œå†å±•å¼€å®ç°æ–¹æ¡ˆç»†èŠ‚"],
    "uncertainties": []
  }
}
```

### 12. é‡ç½®ä¼šè¯
**DELETE** `/simulator/reset/{session_id}`

ç»“æŸå¹¶æ¸…é™¤æŒ‡å®šçš„æ¨¡æ‹Ÿä¼šè¯ã€‚

### 13. è¿è¡Œå®Œæ•´åœºæ™¯æ¨¡æ‹Ÿ (æ–°)
**POST** `/simulator/run`

ä¸€é”®è¿è¡Œå®Œæ•´çš„èŒåœºæ¨¡æ‹Ÿåœºæ™¯ï¼Œåå°è‡ªåŠ¨è¿›è¡Œå¤šè½®å¯¹è¯æ¨æ¼”ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user_001",
  "user_name": "Me",
  "people": [
    {
      "kind": "leader",
      "name": "David",
      "title": "ç›´å±é¢†å¯¼",
      "persona": "æ§åˆ¶æ¬²å¼ºï¼Œå–œæ¬¢å¬å¥½è¯ï¼Œä½†å…³é”®æ—¶åˆ»èƒ½æ‰›äº‹ã€‚",
      "engine": "deepseek"
    },
    {
      "kind": "leader",
      "name": "Sarah",
      "title": "éƒ¨é—¨æ€»ç›‘",
      "persona": "ç»“æœå¯¼å‘ï¼Œé›·å‰é£è¡Œï¼Œä¸å–œæ¬¢å¬å€Ÿå£ã€‚",
      "engine": "qwen3"
    }
  ],
  "leaders": [
    {
      "name": "David",
      "title": "ç›´å±é¢†å¯¼",
      "persona": "æ§åˆ¶æ¬²å¼ºï¼Œå–œæ¬¢å¬å¥½è¯ï¼Œä½†å…³é”®æ—¶åˆ»èƒ½æ‰›äº‹ã€‚"
    },
    {
      "name": "Sarah",
      "title": "éƒ¨é—¨æ€»ç›‘",
      "persona": "ç»“æœå¯¼å‘ï¼Œé›·å‰é£è¡Œï¼Œä¸å–œæ¬¢å¬å€Ÿå£ã€‚"
    }
  ],
  "scenario": "å‘ä¸¤ä½é¢†å¯¼æ±‡æŠ¥ï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘é‡åˆ°æŠ€æœ¯ç“¶é¢ˆï¼Œä¸å¾—ä¸æ¨è¿Ÿä¸Šçº¿ä¸€å‘¨ã€‚",
  "max_rounds": 10
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "messages": [
    {
      "sender": "David",
      "content": "è¿™å‘¨äº”å¿…é¡»ä¸Šçº¿ï¼Œè¿™æ˜¯æ­»å‘½ä»¤ï¼",
      "role": "assistant"
    },
    {
      "sender": "Sarah",
      "content": "Davidï¼Œå…ˆåˆ«æ€¥ï¼Œè®©ä»–è§£é‡Šä¸€ä¸‹å…·ä½“çš„æŠ€æœ¯ç“¶é¢ˆæ˜¯ä»€ä¹ˆã€‚",
      "role": "assistant"
    },
    ...
  ],
  "analysis": {
    "overall_risk_score": 75,
    "risks": [],
    "persona_updates": [],
    "situation_insights": [],
    "next_actions": [],
    "uncertainties": []
  }
}
```

### 14. ä»»åŠ¡åŒ–æ¨æ¼”ï¼šå¯åŠ¨å•è½®å¯¹è¯ä½œä¸šï¼ˆJobï¼‰
**POST** `/simulator/jobs/chat`

æŠŠä¸€æ¬¡ `/simulator/chat` å˜ä¸ºåå°ä½œä¸šï¼Œè¿”å› `job_id`ï¼Œä¾¿äºè½®è¯¢çŠ¶æ€ã€è·å–ç»“æœæˆ–æµå¼è®¢é˜…è¾“å‡ºã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "æˆ‘æƒ³æŠŠä¸Šçº¿æ—¶é—´ä»å‘¨äº”è°ƒæ•´åˆ°ä¸‹å‘¨ä¸‰ï¼ŒåŸå› æ˜¯å…³é”®ä¾èµ–æ–¹ä¸ç¨³å®šã€‚ä½ ä»¬æ€ä¹ˆçœ‹ï¼Ÿ"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "job_id": "a2f7c0c0-1111-2222-3333-444455556666",
  "status": "pending",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": 1730000000.0,
  "updated_at": 1730000000.0
}
```

### 15. ä»»åŠ¡åŒ–æ¨æ¼”ï¼šå¯åŠ¨å®Œæ•´åœºæ™¯ä½œä¸šï¼ˆJobï¼‰
**POST** `/simulator/jobs/run`

ç­‰ä»·äº `/simulator/run`ï¼Œä½†ä»¥åå°ä½œä¸šæ‰§è¡Œï¼Œå¹¶è¿”å› `job_id`ï¼ˆåŒæ—¶è¿”å›æ–°åˆ›å»ºçš„ `session_id`ï¼‰ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user_001",
  "user_name": "Me",
  "people": [
    { "kind": "leader", "name": "David", "title": "ç›´å±é¢†å¯¼", "persona": "æ§åˆ¶æ¬²å¼º", "engine": "deepseek" }
  ],
  "scenario": "å‘é¢†å¯¼æ±‡æŠ¥ï¼šä¸Šçº¿è¦å»¶æœŸä¸€å‘¨ã€‚",
  "max_rounds": 10
}
```

### 16. æŸ¥è¯¢ä½œä¸šçŠ¶æ€
**GET** `/simulator/jobs/{job_id}/status`

**å“åº”ç¤ºä¾‹:**

```json
{
  "job_id": "a2f7c0c0-1111-2222-3333-444455556666",
  "status": "running",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "error": null,
  "created_at": 1730000000.0,
  "updated_at": 1730000002.0
}
```

### 17. è·å–ä½œä¸šç»“æœ
**GET** `/simulator/jobs/{job_id}/result`

è¿”å›å­—æ®µåŒ…å«ï¼š
- `messages`: å·²ç”Ÿæˆçš„æ¶ˆæ¯ï¼ˆä¼šéšä½œä¸šè¿è¡Œé€æ­¥ç´¯ç§¯ï¼‰
- `analysis`: ä½œä¸šå®Œæˆåçš„ç»“æ„åŒ–æ´å¯Ÿï¼ˆé£é™©/ç”»åƒåå·®/ä¸‹ä¸€æ­¥åŠ¨ä½œç­‰ï¼‰

**å“åº”ç¤ºä¾‹:**

```json
{
  "job_id": "a2f7c0c0-1111-2222-3333-444455556666",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "completed",
  "messages": [
    { "sender": "David", "content": "æŠ“æ‰‹æ˜¯ä»€ä¹ˆï¼Ÿ", "role": "assistant" }
  ],
  "analysis": { "overall_risk_score": 55, "risks": [], "persona_updates": [], "situation_insights": [], "next_actions": [], "uncertainties": [] },
  "error": null
}
```

### 18. SSE æµå¼è®¢é˜…ä½œä¸šè¾“å‡º
**GET** `/simulator/jobs/{job_id}/stream`

è¿”å› `text/event-stream`ï¼Œäº‹ä»¶ç±»å‹ï¼š
- `status`: ä½œä¸šçŠ¶æ€å˜æ›´
- `message`: æ–°æ¶ˆæ¯
- `analysis`: æœ€ç»ˆæ´å¯Ÿ
- `done`: ç»“æŸ

ç¤ºä¾‹ï¼ˆå¯é€‰åŠ  `-H "X-API-Key: ..."`ï¼‰ï¼š

```bash
curl -N "http://localhost:8001/simulator/jobs/<job_id>/stream"
```

**SSE äº‹ä»¶ç¤ºä¾‹ï¼ˆç‰‡æ®µï¼‰**ï¼š

```
event: status
data: {"job_id":"...","status":"running"}

event: message
data: {"sender":"David","content":"æŠ“æ‰‹æ˜¯ä»€ä¹ˆï¼Ÿ","role":"assistant"}

event: analysis
data: {"overall_risk_score":55,"risks":[],"persona_updates":[],"situation_insights":[],"next_actions":[],"uncertainties":[]}

event: done
data: {}
```

### 19. WebSocket æµå¼è®¢é˜…ä½œä¸šè¾“å‡º
**WS** `/simulator/jobs/{job_id}/ws`

å®¢æˆ·ç«¯éœ€åœ¨æ¡æ‰‹æ—¶æºå¸¦ `X-API-Key` headerï¼ˆå½“æœåŠ¡ç«¯å¼€å¯ API Key æ ¡éªŒæ—¶ï¼‰ã€‚

**æ¶ˆæ¯æ ¼å¼**
- `{"type":"status","job_id":"...","status":"running"}`
- `{"type":"message","data":{...}}`
- `{"type":"analysis","data":{...}}`
- `{"type":"error","error":"..."}` æˆ– `{"type":"error","detail":"..."}`
- `{"type":"done"}`

### 20. Persona ç‰ˆæœ¬å›æº¯ï¼šåˆ—å‡ºç‰ˆæœ¬
**GET** `/simulator/persona/{user_id}/{person_name}/versions?limit=50`

**å“åº”ç¤ºä¾‹:**

```json
{
  "versions": [
    {
      "id": "persona-version-id",
      "person_title": "ç›´å±é¢†å¯¼",
      "persona": "æ›´æ–°åçš„ç”»åƒ...",
      "deviation_summary": "åå·®ä¸¾è¯ä¸è®ºè¯...",
      "confidence": 0.82,
      "created_at": "2026-02-11 11:00:00"
    }
  ]
}
```

### 21. Persona ç‰ˆæœ¬å›æº¯ï¼šå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
**POST** `/simulator/persona/{user_id}/{person_name}/rollback`

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "persona_version_id": "the-version-id-to-rollback"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "rolled_back_to": "the-version-id-to-rollback",
  "new_version_id": "new-version-id"
}
```

---

## ğŸ¢ å±€åŠ¿ç®¡ç† (Situation)

### 1. æ›´æ–°å±€åŠ¿
**POST** `/situation/update`

ç”¨äºåˆå§‹åŒ–æˆ–æ›´æ–°ç”¨æˆ·çš„èŒåœºçŠ¶æ€æ¨¡å‹ã€‚è¿™æ˜¯ç³»ç»Ÿè¿›è¡Œå†³ç­–çš„åŸºç¡€ä¸Šä¸‹æ–‡ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user",
  "situation": {
    "career_type": "äº’è”ç½‘å¤§å‚",   // è¡Œä¸šç±»å‹ï¼šäº’è”ç½‘/å›½ä¼/å¤–ä¼/ç§ä¼
    "current_level": "P6",       // å½“å‰èŒçº§
    "target_level": "P7",        // ç›®æ ‡èŒçº§
    "promotion_window": true,    // æ˜¯å¦å¤„äºæ™‹å‡çª—å£æœŸ
    "stakeholders": [            // å…³é”®å¹²ç³»äººåˆ—è¡¨ï¼Œæ”¯æŒå¤šè§’è‰²åˆ†æ
      {
        "name": "David",
        "role": "ç›´å±é¢†å¯¼",      // è§’è‰²èº«ä»½: Line Manager, Skip Manager, Peer ç­‰
        "style": "æ§åˆ¶æ¬²å¼º",     // è¡Œäº‹é£æ ¼: é£é™©åŒæ¶å‹, ç»“æœå¯¼å‘å‹, æ”¿æ²»åŠ¨ç‰©ç­‰
        "relationship": "ä¿¡ä»»",  // å…³ç³»çŠ¶æ€: ä¿¡ä»», çŒœå¿Œ, ç›Ÿå‹, æ•Œå¯¹, Neutral
        "influence_level": "High" // å¯¹æ™‹å‡çš„å½±å“åŠ›: High, Medium, Low
      },
      {
        "name": "Sarah",
        "role": "éš”å£ç»„é•¿",
        "style": "æŠ¢åŠŸå‹",
        "relationship": "ç«äº‰",
        "influence_level": "Medium"
      }
    ],
    "current_phase": "å†²åˆºæœŸ",     // å½“å‰é˜¶æ®µï¼šè§‚å¯ŸæœŸ/å†²åˆºæœŸ/å¹³ç¨³æœŸ/åŠ¨è¡æœŸ
    "personal_goal": "å»ºç«‹é è°±äººè®¾", // ä¸ªäººæ ¸å¿ƒç›®æ ‡
    "recent_events": []          // (å¯é€‰) è¿‘æœŸå…³é”®äº‹ä»¶åˆ—è¡¨
  }
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "message": "Situation updated successfully",
  "situation": { ... } // è¿”å›æ›´æ–°åçš„å®Œæ•´å¯¹è±¡
}
```

### 2. è·å–å±€åŠ¿
**GET** `/situation/{user_id}`

è·å–æŒ‡å®šç”¨æˆ·çš„å½“å‰å±€åŠ¿é…ç½®ã€‚å¦‚æœæœªè®¾ç½®ï¼Œå°†è¿”å›ç³»ç»Ÿé»˜è®¤çš„ Mock æ•°æ®ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰ã€‚

**å‚æ•°:**
- `user_id` (path): ç”¨æˆ·å”¯ä¸€æ ‡è¯†

### 3. é‡ç½®å±€åŠ¿
**DELETE** `/situation/{user_id}`

åˆ é™¤ç”¨æˆ·çš„å±€åŠ¿é…ç½®ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚

---

## ğŸ§  ç­–ç•¥ä¸å†³ç­– (Advice)

### 4. ç”Ÿæˆå»ºè®® (æ ¸å¿ƒæ¥å£)
**POST** `/advice/generate`

è¾“å…¥ä»Šæ—¥å‘ç”Ÿçš„èŒåœºäº‹å®ï¼Œç³»ç»Ÿç»“åˆå±€åŠ¿å’Œå†å²è®°å¿†ï¼Œç”Ÿæˆç­–ç•¥å»ºè®®ä¸è¯æœ¯ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user",
  "fact": "é¡¹ç›®Aå› ä¸ºç¬¬ä¸‰æ–¹APIä¸ç¨³å®šå¯¼è‡´å»¶æœŸ1å¤©ï¼Œä½†æˆ‘ä¸Šå‘¨äº”å·²ç»åœ¨å‘¨æŠ¥é‡Œæç¤ºè¿‡è¿™ä¸ªé£é™©äº†ã€‚"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "decision": {
    "should_say": true,
    "timing_check": "åˆé€‚",
    "strategic_intent": "é˜²å®ˆ/æ”¶å‰²/æ½œä¼",
    "strategy_summary": "..."
  },
  "narrative": {
    "boss_version": "é¢†å¯¼ï¼ŒåŒæ­¥ä¸‹é¡¹ç›®Aè¿›åº¦...", // å¯¹ä¸Šæ±‡æŠ¥ç‰ˆæœ¬
    "self_version": "...",                  // è‡ªæˆ‘å¤ç›˜ç‰ˆæœ¬
    "strategy_hints": "..."                 // ä¸‹ä¸€æ­¥è¡ŒåŠ¨æç¤º
  },
  "context_used": {
    "situation": "...",  // æœ¬æ¬¡å†³ç­–å‚è€ƒçš„å±€åŠ¿ä¿¡æ¯
    "memory": "..."      // æœ¬æ¬¡å†³ç­–æ£€ç´¢åˆ°çš„å†å²è®°å¿†
  }
}
```

---

## ğŸ“ è®°å¿†ç®¡ç† (Memory)

### 5. æŸ¥è¯¢è®°å¿†
**POST** `/memory/query`

æ ¹æ®è¯­ä¹‰æ£€ç´¢ç›¸å…³çš„å†å²è®°å¿†ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user",
  "query": "è€æ¿å‘ç«", // æœç´¢å…³é”®è¯æˆ–æè¿°
  "limit": 10        // (å¯é€‰) è¿”å›æ¡æ•°é™åˆ¶ï¼Œé»˜è®¤ 10
}
```

### 6. è·å–æ‰€æœ‰è®°å¿†
**GET** `/memory/{user_id}/all`

æŒ‰æ—¶é—´å€’åºè¿”å›è¯¥ç”¨æˆ·çš„æ‰€æœ‰è®°å¿†ç‰‡æ®µã€‚

**å“åº”ç¤ºä¾‹:**

```json
{
  "memories": [
    {
      "id": "uuid-...",
      "memory": "è€æ¿å¯¹è¿›åº¦å»¶æœŸæåº¦æ•æ„Ÿ...",
      "created_at": "2026-02-05T...",
      "metadata": {
        "category": "insight",
        "source": "consolidation"
      }
    },
    ...
  ]
}
```

### 7. è§¦å‘è®°å¿†æ•´ç†
**POST** `/memory/{user_id}/consolidate`

æ‰‹åŠ¨è§¦å‘â€œé•¿æœŸè®°å¿†æ•´ç†â€è¿›ç¨‹ã€‚ç³»ç»Ÿä¼šåˆ†æè¿‘æœŸé›¶æ•£è®°å¿†ï¼Œæç‚¼å‡ºé«˜ç»´åº¦çš„æ´å¯Ÿï¼ˆInsightï¼‰ï¼Œå¹¶å­˜å…¥è®°å¿†åº“ã€‚

**å“åº”ç¤ºä¾‹:**

```json
{
  "message": "Consolidated 10 memories into 3 insights",
  "insights": [
    "è€æ¿å€¾å‘äºåœ¨å‘¨ä¸€æ—©ä¼šå‘ç«ï¼Œå»ºè®®é¿å¼€æ­¤æ—¶æ±‡æŠ¥åæ¶ˆæ¯",
    ...
  ]
}
```

### 8. åˆ é™¤è®°å¿†
**DELETE** `/memory/{user_id}/{memory_id}`

åˆ é™¤æŒ‡å®šçš„å•æ¡è®°å¿†ã€‚

### 9. æ¸…ç©ºè®°å¿†
**DELETE** `/memory/{user_id}`

âš ï¸ **å±é™©æ“ä½œ**ï¼šæ¸…ç©ºè¯¥ç”¨æˆ·çš„æ‰€æœ‰è®°å¿†æ•°æ®ã€‚

---

## ğŸ—£ï¸ ç”¨æˆ·åé¦ˆ (Feedback)

### 14. æäº¤åé¦ˆ (æ–°)
**POST** `/feedback/submit`

æäº¤ç”¨æˆ·å¯¹ç³»ç»Ÿç”Ÿæˆå»ºè®®çš„åé¦ˆï¼Œç”¨äºåç»­ä¼˜åŒ–ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user",
  "fact": "é¡¹ç›®Aå»¶æœŸäº†",
  "advice_result": { ... }, // å¯¹åº” /advice/generate çš„è¿”å›ç»“æœ
  "rating": 5, // è¯„åˆ† 1-5
  "comment": "è¿™ä¸ªå»ºè®®å¾ˆå®ç”¨ï¼"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "message": "Feedback received",
  "id": "uuid-..."
}
```

---

## é”™è¯¯ç 

- **200 OK**: è¯·æ±‚æˆåŠŸ
- **422 Unprocessable Entity**: å‚æ•°æ ¼å¼é”™è¯¯ (Pydantic æ ¡éªŒå¤±è´¥)
- **500 Internal Server Error**: æœåŠ¡ç«¯å†…éƒ¨é”™è¯¯ (å¦‚ LLM è°ƒç”¨å¤±è´¥ã€æ•°æ®åº“é”™è¯¯)
