# æ¥äº‹å„¿ (Lai Shi Er) API æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†åç«¯æœåŠ¡æä¾›çš„æ‰€æœ‰ API æ¥å£ã€è¯·æ±‚å‚æ•°åŠå“åº”ç¤ºä¾‹ã€‚

## åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8001`
- **Content-Type**: `application/json`

---

## ğŸ­ èŒåœºæ¨¡æ‹Ÿå™¨ (Simulator)

åŸºäº AutoGen å¤šæ™ºèƒ½ä½“æ¡†æ¶ï¼Œæ¨¡æ‹ŸçœŸå®çš„èŒåœºäººé™…äº¤äº’ç¯å¢ƒã€‚

### 10. åˆå§‹åŒ–æ¨¡æ‹Ÿä¼šè¯
**POST** `/simulator/start`

åˆ›å»ºä¸€ä¸ªæ–°çš„èŒåœºæ¨¡æ‹Ÿç¯å¢ƒï¼ŒåŒ…å«ç”¨æˆ·è‡ªå·±ã€é¢„è®¾çš„é¢†å¯¼ Agentã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_name": "Me",
  "leaders": [
    {
      "name": "David",
      "title": "ç›´å±é¢†å¯¼",
      "persona": "æ§åˆ¶æ¬²å¼ºï¼Œå–œæ¬¢å¬å¥½è¯ï¼Œä½†å…³é”®æ—¶åˆ»èƒ½æ‰›äº‹ã€‚å£å¤´ç¦…æ˜¯'æŠ“æ‰‹'ã€'èµ‹èƒ½'ã€‚"
    },
    {
      "name": "Sarah",
      "title": "éƒ¨é—¨æ€»ç›‘",
      "persona": "ç»“æœå¯¼å‘ï¼Œé›·å‰é£è¡Œï¼Œä¸å–œæ¬¢å¬å€Ÿå£ï¼Œåªçœ‹æ•°æ®ã€‚"
    }
  ]
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

### 11. å‘é€æ¶ˆæ¯å¹¶è·å–å›å¤
**POST** `/simulator/chat`

ç”¨æˆ·åœ¨æ¨¡æ‹Ÿå™¨ä¸­å‘è¨€ï¼Œè§¦å‘å¤š Agent äº¤äº’ï¼Œå¹¶è·å–ä»–ä»¬çš„å›å¤æµã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "å¤§å®¶è§‰å¾—è¿™ä¸ªæ–¹æ¡ˆæ€ä¹ˆæ ·ï¼Ÿ"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "new_messages": [
    {
      "sender": "David",
      "content": "æˆ‘è§‰å¾—æ–¹å‘æ˜¯å¯¹çš„ï¼Œä½†æ˜¯æŠ“æ‰‹åœ¨å“ªé‡Œï¼Ÿ",
      "role": "assistant"
    },
    {
      "sender": "Sarah",
      "content": "æ•°æ®å‘¢ï¼Ÿæˆ‘éœ€è¦çœ‹åˆ°ROIçš„é¢„æµ‹ã€‚",
      "role": "assistant"
    }
  ]
}
```

### 12. é‡ç½®ä¼šè¯
**DELETE** `/simulator/reset/{session_id}`

ç»“æŸå¹¶æ¸…é™¤æŒ‡å®šçš„æ¨¡æ‹Ÿä¼šè¯ã€‚

### 13. è¿è¡Œå®Œæ•´åœºæ™¯æ¨¡æ‹Ÿ (æ–°)
**POST** `/simulator/run`

ä¸€é”®è¿è¡Œå®Œæ•´çš„èŒåœºæ¨¡æ‹Ÿåœºæ™¯ï¼Œåå°è‡ªåŠ¨è¿›è¡Œå¤šè½®å¯¹è¯æ¨æ¼”ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_name": "Me",
  "leaders": [
    {
      "name": "David",
      "title": "ç›´å±é¢†å¯¼",
      "persona": "æ§åˆ¶æ¬²å¼ºï¼Œå–œæ¬¢å¬å¥½è¯ï¼Œä½†å…³é”®æ—¶åˆ»èƒ½æ‰›äº‹ã€‚"
    },
    {
      "name": "Sarah",
      "title": "éƒ¨é—¨æ€»ç›‘",
      "persona": "ç»“æœå¯¼å‘ï¼Œé›·å‰é£è¡Œï¼Œä¸å–œæ¬¢å¬å€Ÿå£ã€‚"
    }
  ],
  "scenario": "å‘ä¸¤ä½é¢†å¯¼æ±‡æŠ¥ï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘é‡åˆ°æŠ€æœ¯ç“¶é¢ˆï¼Œä¸å¾—ä¸æ¨è¿Ÿä¸Šçº¿ä¸€å‘¨ã€‚",
  "max_rounds": 10
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "messages": [
    {
      "sender": "David",
      "content": "è¿™å‘¨äº”å¿…é¡»ä¸Šçº¿ï¼Œè¿™æ˜¯æ­»å‘½ä»¤ï¼",
      "role": "assistant"
    },
    {
      "sender": "Sarah",
      "content": "Davidï¼Œå…ˆåˆ«æ€¥ï¼Œè®©ä»–è§£é‡Šä¸€ä¸‹å…·ä½“çš„æŠ€æœ¯ç“¶é¢ˆæ˜¯ä»€ä¹ˆã€‚",
      "role": "assistant"
    },
    ...
  ]
}
```

---

## ğŸ¢ å±€åŠ¿ç®¡ç† (Situation)

### 1. æ›´æ–°å±€åŠ¿
**POST** `/situation/update`

ç”¨äºåˆå§‹åŒ–æˆ–æ›´æ–°ç”¨æˆ·çš„èŒåœºçŠ¶æ€æ¨¡å‹ã€‚è¿™æ˜¯ç³»ç»Ÿè¿›è¡Œå†³ç­–çš„åŸºç¡€ä¸Šä¸‹æ–‡ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user",
  "situation": {
    "career_type": "äº’è”ç½‘å¤§å‚",   // è¡Œä¸šç±»å‹ï¼šäº’è”ç½‘/å›½ä¼/å¤–ä¼/ç§ä¼
    "current_level": "P6",       // å½“å‰èŒçº§
    "target_level": "P7",        // ç›®æ ‡èŒçº§
    "promotion_window": true,    // æ˜¯å¦å¤„äºæ™‹å‡çª—å£æœŸ
    "boss_style": "é£é™©åŒæ¶å‹",    // è€æ¿é£æ ¼ï¼šé£é™©åŒæ¶/æ§åˆ¶å‹/æ”¾æƒå‹/æ¿€è¿›å‹
    "current_phase": "å†²åˆºæœŸ",     // å½“å‰é˜¶æ®µï¼šè§‚å¯ŸæœŸ/å†²åˆºæœŸ/å¹³ç¨³æœŸ/åŠ¨è¡æœŸ
    "personal_goal": "å»ºç«‹é è°±äººè®¾", // ä¸ªäººæ ¸å¿ƒç›®æ ‡
    "recent_events": []          // (å¯é€‰) è¿‘æœŸå…³é”®äº‹ä»¶åˆ—è¡¨
  }
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "message": "Situation updated successfully",
  "situation": { ... } // è¿”å›æ›´æ–°åçš„å®Œæ•´å¯¹è±¡
}
```

### 2. è·å–å±€åŠ¿
**GET** `/situation/{user_id}`

è·å–æŒ‡å®šç”¨æˆ·çš„å½“å‰å±€åŠ¿é…ç½®ã€‚å¦‚æœæœªè®¾ç½®ï¼Œå°†è¿”å›ç³»ç»Ÿé»˜è®¤çš„ Mock æ•°æ®ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰ã€‚

**å‚æ•°:**
- `user_id` (path): ç”¨æˆ·å”¯ä¸€æ ‡è¯†

### 3. é‡ç½®å±€åŠ¿
**DELETE** `/situation/{user_id}`

åˆ é™¤ç”¨æˆ·çš„å±€åŠ¿é…ç½®ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚

---

## ğŸ§  ç­–ç•¥ä¸å†³ç­– (Advice)

### 4. ç”Ÿæˆå»ºè®® (æ ¸å¿ƒæ¥å£)
**POST** `/advice/generate`

è¾“å…¥ä»Šæ—¥å‘ç”Ÿçš„èŒåœºäº‹å®ï¼Œç³»ç»Ÿç»“åˆå±€åŠ¿å’Œå†å²è®°å¿†ï¼Œç”Ÿæˆç­–ç•¥å»ºè®®ä¸è¯æœ¯ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user",
  "fact": "é¡¹ç›®Aå› ä¸ºç¬¬ä¸‰æ–¹APIä¸ç¨³å®šå¯¼è‡´å»¶æœŸ1å¤©ï¼Œä½†æˆ‘ä¸Šå‘¨äº”å·²ç»åœ¨å‘¨æŠ¥é‡Œæç¤ºè¿‡è¿™ä¸ªé£é™©äº†ã€‚"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "decision": {
    "should_say": true,
    "timing_check": "åˆé€‚",
    "strategic_intent": "é˜²å®ˆ/æ”¶å‰²/æ½œä¼",
    "strategy_summary": "..."
  },
  "narrative": {
    "boss_version": "é¢†å¯¼ï¼ŒåŒæ­¥ä¸‹é¡¹ç›®Aè¿›åº¦...", // å¯¹ä¸Šæ±‡æŠ¥ç‰ˆæœ¬
    "self_version": "...",                  // è‡ªæˆ‘å¤ç›˜ç‰ˆæœ¬
    "strategy_hints": "..."                 // ä¸‹ä¸€æ­¥è¡ŒåŠ¨æç¤º
  },
  "context_used": {
    "situation": "...",  // æœ¬æ¬¡å†³ç­–å‚è€ƒçš„å±€åŠ¿ä¿¡æ¯
    "memory": "..."      // æœ¬æ¬¡å†³ç­–æ£€ç´¢åˆ°çš„å†å²è®°å¿†
  }
}
```

---

## ğŸ“ è®°å¿†ç®¡ç† (Memory)

### 5. æŸ¥è¯¢è®°å¿†
**POST** `/memory/query`

æ ¹æ®è¯­ä¹‰æ£€ç´¢ç›¸å…³çš„å†å²è®°å¿†ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user",
  "query": "è€æ¿å‘ç«", // æœç´¢å…³é”®è¯æˆ–æè¿°
  "limit": 10        // (å¯é€‰) è¿”å›æ¡æ•°é™åˆ¶ï¼Œé»˜è®¤ 10
}
```

### 6. è·å–æ‰€æœ‰è®°å¿†
**GET** `/memory/{user_id}/all`

æŒ‰æ—¶é—´å€’åºè¿”å›è¯¥ç”¨æˆ·çš„æ‰€æœ‰è®°å¿†ç‰‡æ®µã€‚

**å“åº”ç¤ºä¾‹:**

```json
{
  "memories": [
    {
      "id": "uuid-...",
      "memory": "è€æ¿å¯¹è¿›åº¦å»¶æœŸæåº¦æ•æ„Ÿ...",
      "created_at": "2026-02-05T...",
      "metadata": {
        "category": "insight",
        "source": "consolidation"
      }
    },
    ...
  ]
}
```

### 7. è§¦å‘è®°å¿†æ•´ç†
**POST** `/memory/{user_id}/consolidate`

æ‰‹åŠ¨è§¦å‘â€œé•¿æœŸè®°å¿†æ•´ç†â€è¿›ç¨‹ã€‚ç³»ç»Ÿä¼šåˆ†æè¿‘æœŸé›¶æ•£è®°å¿†ï¼Œæç‚¼å‡ºé«˜ç»´åº¦çš„æ´å¯Ÿï¼ˆInsightï¼‰ï¼Œå¹¶å­˜å…¥è®°å¿†åº“ã€‚

**å“åº”ç¤ºä¾‹:**

```json
{
  "message": "Consolidated 10 memories into 3 insights",
  "insights": [
    "è€æ¿å€¾å‘äºåœ¨å‘¨ä¸€æ—©ä¼šå‘ç«ï¼Œå»ºè®®é¿å¼€æ­¤æ—¶æ±‡æŠ¥åæ¶ˆæ¯",
    ...
  ]
}
```

### 8. åˆ é™¤è®°å¿†
**DELETE** `/memory/{user_id}/{memory_id}`

åˆ é™¤æŒ‡å®šçš„å•æ¡è®°å¿†ã€‚

### 9. æ¸…ç©ºè®°å¿†
**DELETE** `/memory/{user_id}`

âš ï¸ **å±é™©æ“ä½œ**ï¼šæ¸…ç©ºè¯¥ç”¨æˆ·çš„æ‰€æœ‰è®°å¿†æ•°æ®ã€‚

---

## ğŸ—£ï¸ ç”¨æˆ·åé¦ˆ (Feedback)

### 14. æäº¤åé¦ˆ (æ–°)
**POST** `/feedback/submit`

æäº¤ç”¨æˆ·å¯¹ç³»ç»Ÿç”Ÿæˆå»ºè®®çš„åé¦ˆï¼Œç”¨äºåç»­ä¼˜åŒ–ã€‚

**è¯·æ±‚ä½“ (JSON):**

```json
{
  "user_id": "demo_user",
  "fact": "é¡¹ç›®Aå»¶æœŸäº†",
  "advice_result": { ... }, // å¯¹åº” /advice/generate çš„è¿”å›ç»“æœ
  "rating": 5, // è¯„åˆ† 1-5
  "comment": "è¿™ä¸ªå»ºè®®å¾ˆå®ç”¨ï¼"
}
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "message": "Feedback received",
  "id": "uuid-..."
}
```

---

## é”™è¯¯ç 

- **200 OK**: è¯·æ±‚æˆåŠŸ
- **422 Unprocessable Entity**: å‚æ•°æ ¼å¼é”™è¯¯ (Pydantic æ ¡éªŒå¤±è´¥)
- **500 Internal Server Error**: æœåŠ¡ç«¯å†…éƒ¨é”™è¯¯ (å¦‚ LLM è°ƒç”¨å¤±è´¥ã€æ•°æ®åº“é”™è¯¯)
